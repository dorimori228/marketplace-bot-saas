<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PandaBay - Facebook Marketplace Automation</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Color Palette */
            --navy: #30364F;
            --gray-blue: #ACBAC4;
            --beige: #E1D9BC;
            --cream: #F0F0DB;

            /* Semantic Colors */
            --primary: #30364F;
            --primary-dark: #252a3d;
            --primary-light: #4a5170;
            --secondary: #E1D9BC;
            --accent: #C8B896;
            --danger: #d97668;
            --success: #88b398;
            --background: #F0F0DB;
            --sidebar-bg: linear-gradient(180deg, #30364F 0%, #252a3d 100%);
            --sidebar-hover: rgba(225, 217, 188, 0.1);
            --card-bg: #fafaf8;
            --text-primary: #30364F;
            --text-secondary: #7a8a96;
            --border: rgba(172, 186, 196, 0.3);
            --shadow: 0 1px 3px 0 rgba(48, 54, 79, 0.1), 0 1px 2px 0 rgba(48, 54, 79, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(48, 54, 79, 0.1), 0 2px 4px -1px rgba(48, 54, 79, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(48, 54, 79, 0.15), 0 4px 6px -2px rgba(48, 54, 79, 0.08);
            --shadow-xl: 0 20px 25px -5px rgba(48, 54, 79, 0.15), 0 10px 10px -5px rgba(48, 54, 79, 0.08);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            color: white;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-xl);
            z-index: 100;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-header {
            padding: 32px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }

        .logo-img {
            width: 120px;
            height: 120px;
            border-radius: 20px;
            object-fit: contain;
            background: white;
            padding: 16px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .brand-name {
            display: none;
        }

        .sidebar-header p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 4px;
            font-weight: 500;
        }

        .sidebar-nav {
            flex: 1;
            padding: 24px 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 14px 24px;
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: rgba(255, 255, 255, 0.8);
            font-size: 15px;
            font-weight: 500;
            border-left: 3px solid transparent;
            position: relative;
        }

        .nav-item i {
            width: 20px;
            font-size: 18px;
            transition: transform 0.2s ease;
        }

        .nav-item:hover {
            background: var(--sidebar-hover);
            color: white;
        }

        .nav-item:hover i {
            transform: scale(1.1);
        }

        .nav-item.active {
            background: var(--sidebar-hover);
            color: white;
            border-left-color: var(--primary-light);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 60%;
            background: var(--primary-light);
            border-radius: 4px 0 0 4px;
        }

        .sidebar-footer {
            padding: 20px 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ai-toggle-container {
            position: fixed;
            top: 18px;
            right: 24px;
            z-index: 300;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            font-size: 13px;
            color: var(--text-secondary);
        }

        .ai-toggle-label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .ai-switch {
            position: relative;
            display: inline-block;
            width: 46px;
            height: 26px;
        }

        .ai-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .ai-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.2s;
            border-radius: 999px;
        }

        .ai-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.2s;
            border-radius: 50%;
            box-shadow: var(--shadow);
        }

        .ai-switch input:checked + .ai-slider {
            background-color: var(--primary);
        }

        .ai-switch input:checked + .ai-slider:before {
            transform: translateX(20px);
        }

        .feature-badge {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            padding: 12px 16px;
            border-radius: 12px;
            text-align: center;
            font-size: 13px;
            font-weight: 600;
            box-shadow: var(--shadow-lg);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page-view {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }

        .page-view.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-header h2 {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .page-header h2 i {
            color: var(--primary);
        }

        .page-header p {
            font-size: 16px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px);
        }

        .card-header {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary);
        }

        /* Forms */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .required {
            color: var(--danger);
            margin-left: 4px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s ease;
            background: var(--card-bg);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(48, 54, 79, 0.1);
            transform: translateY(-1px);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Enhanced Select Styling */
        .form-select {
            font-weight: 600;
            cursor: pointer;
            appearance: none;
            background: white;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2330364F' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 20px;
            padding-right: 50px;
            box-shadow: var(--shadow);
        }

        .form-select:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(48, 54, 79, 0.02) 0%, rgba(225, 217, 188, 0.03) 100%), white;
            box-shadow: var(--shadow-md);
        }

        .form-select option {
            padding: 12px;
            font-size: 15px;
            font-weight: 500;
            background: white;
            color: var(--text-primary);
        }

        .form-select option:first-child {
            color: var(--text-secondary);
            font-style: italic;
        }

        .category-custom {
            display: none;
            margin-top: 10px;
        }

        .category-custom.active {
            display: block;
        }

        .category-info {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-top: 8px;
            padding: 10px 12px;
            background: rgba(48, 54, 79, 0.06);
            border: 1px solid rgba(48, 54, 79, 0.15);
            border-radius: 10px;
            font-size: 12.5px;
            color: var(--text-secondary);
        }

        .category-info i {
            color: var(--primary);
            margin-top: 2px;
        }

        .category-add-btn {
            width: 44px;
            min-width: 44px;
            height: 44px;
            border-radius: 10px;
            border: 2px solid var(--border);
            background: var(--card-bg);
            color: var(--primary);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .category-add-btn:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px;
            margin-top: 12px;
        }

        .photo-preview-item {
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--border);
            background: white;
            box-shadow: var(--shadow);
        }

        .photo-preview-item img {
            width: 100%;
            height: 90px;
            object-fit: cover;
            display: block;
        }

        .input-group {
            display: flex;
            gap: 8px;
        }

        .input-group .form-input {
            flex: 1;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--text-primary);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--beige) 0%, var(--accent) 100%);
            color: var(--navy);
        }

        .btn-success:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--accent) 0%, var(--beige) 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c86860 100%);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #c86860 0%, var(--danger) 100%);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-full {
            width: 100%;
        }

        .btn-icon {
            background: transparent;
            border: 2px solid var(--border);
            padding: 8px 12px;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            font-weight: 600;
        }

        .btn-icon:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(1.05);
        }

        /* Grid Layout */
        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        @media (max-width: 768px) {
            .grid-2,
            .grid-3,
            .grid-4 {
                grid-template-columns: 1fr;
            }
        }

        /* File Upload */
        .file-upload {
            position: relative;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .file-upload-label {
            display: block;
            padding: 32px;
            border: 3px dashed var(--border);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--background);
            font-weight: 600;
            color: var(--text-secondary);
        }

        .file-upload-label:hover {
            border-color: var(--primary);
            background: rgba(48, 54, 79, 0.05);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .file-upload-label i {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
        }

        /* Alerts */
        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 15px;
            margin-bottom: 24px;
            display: none;
            animation: slideDown 0.3s ease;
            font-weight: 500;
            border-left: 4px solid;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert.success {
            background: #e8f5e9;
            color: var(--success);
            border-color: var(--success);
        }

        .alert.error {
            background: #fdecea;
            color: var(--danger);
            border-color: var(--danger);
        }

        .alert.info {
            background: #e8eaed;
            color: var(--navy);
            border-color: var(--gray-blue);
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tooltip */
        .tooltip-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 6px;
            cursor: help;
            position: relative;
        }

        .tooltip-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50%;
            bottom: calc(100% + 8px);
            transform: translateX(-50%);
            background: var(--text-primary);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            font-weight: normal;
            animation: fadeIn 0.2s ease;
        }

        /* Listings */
        .listings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .listing-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--border);
        }

        .listing-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }

        .listing-card.selected {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(48, 54, 79, 0.1);
        }

        .listing-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: var(--background);
        }

        .listing-content {
            padding: 20px;
        }

        .listing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .listing-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .listing-title {
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 8px;
            color: var(--text-primary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .listing-price {
            font-size: 20px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .listing-meta {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .listing-actions {
            display: flex;
            gap: 8px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .no-listings {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .no-listings-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-primary {
            background: rgba(48, 54, 79, 0.1);
            color: var(--primary);
        }

        .badge-success {
            background: rgba(225, 217, 188, 0.3);
            color: var(--navy);
        }

        .select-count {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 16px;
            box-shadow: var(--shadow-md);
        }

        /* Features Section */
        .features-section {
            margin-top: 32px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .feature-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }

        .feature-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-md);
        }

        .feature-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .feature-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 24px;
            border-radius: 16px;
            color: white;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 600;
        }

        .stat-icon {
            font-size: 32px;
            opacity: 0.3;
            float: right;
        }

        /* Step Indicator */
        .step-container {
            background: linear-gradient(135deg, var(--card-bg) 0%, #ffffff 100%);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 32px;
            border: 3px solid var(--border);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .step-container.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 5px rgba(48, 54, 79, 0.12), var(--shadow-lg);
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .step-number {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 800;
            box-shadow: 0 8px 20px rgba(48, 54, 79, 0.3);
            flex-shrink: 0;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        .step-title {
            flex: 1;
        }

        .step-title h3 {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 6px;
            letter-spacing: -0.5px;
        }

        .step-title p {
            font-size: 16px;
            color: var(--text-secondary);
            margin: 0;
            font-weight: 500;
        }

        .account-select-wrapper {
            position: relative;
        }

        /* Add subtle glow effect to dropdown when open */
        .account-select-large:active {
            box-shadow: 0 0 0 5px rgba(48, 54, 79, 0.15), var(--shadow-xl);
        }

        .account-select-large {
            width: 100%;
            padding: 24px 28px;
            font-size: 20px;
            font-weight: 700;
            border: 3px solid var(--border);
            border-radius: 16px;
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 24 24' fill='none' stroke='%2330364F' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 24px center;
            background-size: 28px;
            padding-right: 70px;
            box-shadow: var(--shadow-md);
            line-height: 1.4;
        }

        .account-select-large:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(48, 54, 79, 0.03) 0%, rgba(225, 217, 188, 0.05) 100%);
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .account-select-large:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 5px rgba(48, 54, 79, 0.15);
            background: white;
        }

        .account-select-large option {
            padding: 16px 20px;
            font-size: 18px;
            font-weight: 600;
            background: white;
            color: var(--text-primary);
            line-height: 2;
        }

        .account-select-large option:hover {
            background: var(--beige);
            color: var(--navy);
        }

        .account-select-large option:checked {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            font-weight: 700;
        }

        .account-select-large option:first-child {
            color: var(--text-secondary);
            font-style: italic;
        }

        .no-accounts-prompt {
            text-align: center;
            padding: 48px 24px;
            background: linear-gradient(135deg, rgba(48, 54, 79, 0.05) 0%, rgba(225, 217, 188, 0.1) 100%);
            border-radius: 16px;
            border: 2px dashed var(--border);
        }

        .no-accounts-prompt .icon {
            font-size: 64px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .no-accounts-prompt h3 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .no-accounts-prompt p {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .actions-container {
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.4s ease;
        }

        .actions-container.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Home Page Styles */
        .home-hero {
            text-align: center;
            padding: 48px 24px;
            background: linear-gradient(135deg, var(--card-bg) 0%, #ffffff 100%);
            border-radius: 24px;
            margin-bottom: 40px;
            border: 3px solid var(--border);
            box-shadow: var(--shadow-lg);
        }

        .home-hero h1 {
            font-size: 48px;
            font-weight: 900;
            color: var(--text-primary);
            margin-bottom: 16px;
            letter-spacing: -1px;
        }

        .home-logo {
            width: min(320px, 70vw);
            height: auto;
            margin-bottom: 16px;
            border-radius: 24px;
            background: white;
            padding: 18px;
            box-shadow: var(--shadow-lg);
        }

        .home-hero .subtitle {
            font-size: 20px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 32px;
        }

        .workflow-steps {
            display: grid;
            gap: 24px;
            margin-bottom: 40px;
        }

        .workflow-step {
            background: linear-gradient(135deg, var(--card-bg) 0%, #ffffff 100%);
            border-radius: 20px;
            padding: 32px;
            border: 3px solid var(--border);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            position: relative;
        }

        .workflow-step:hover {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(48, 54, 79, 0.1), var(--shadow-lg);
            transform: translateY(-2px);
        }

        .workflow-step.completed {
            border-color: var(--success);
            background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
        }

        .workflow-step-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .workflow-step-number {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 900;
            box-shadow: 0 8px 24px rgba(48, 54, 79, 0.3);
            flex-shrink: 0;
            border: 4px solid rgba(255, 255, 255, 0.2);
        }

        .workflow-step.completed .workflow-step-number {
            background: linear-gradient(135deg, var(--success) 0%, #66a57c 100%);
        }

        .workflow-step-title {
            flex: 1;
        }

        .workflow-step-title h3 {
            font-size: 26px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 6px;
            letter-spacing: -0.5px;
        }

        .workflow-step-title p {
            font-size: 16px;
            color: var(--text-secondary);
            margin: 0;
            font-weight: 500;
        }

        .workflow-step-content {
            margin-left: 84px;
        }

        .workflow-step-description {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .workflow-step-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .quick-stat {
            background: var(--card-bg);
            padding: 12px 20px;
            border-radius: 12px;
            border: 2px solid var(--border);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .quick-stat i {
            color: var(--primary);
            font-size: 18px;
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 18px;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo-container">
                <img src="/static/logo/pandabay.png" alt="PandaBay Logo" class="logo-img">
            </div>
            <p style="text-align: center; margin-top: 8px;">Facebook Marketplace Automation</p>
        </div>

        <div class="sidebar-nav">
            <div class="nav-item active" onclick="showPage('home')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" onclick="showPage('create')">
                <i class="fas fa-plus-circle"></i>
                <span>Create Listing</span>
            </div>
            <div class="nav-item" onclick="showPage('manage')">
                <i class="fas fa-list"></i>
                <span>Manage Listings</span>
            </div>
            <div class="nav-item" onclick="showPage('templates')">
                <i class="fas fa-bookmark"></i>
                <span>Templates</span>
            </div>
            <div class="nav-item" onclick="showPage('analytics')">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </div>
            <div class="nav-item" onclick="showPage('activity')">
                <i class="fas fa-history"></i>
                <span>Activity Log</span>
            </div>
            <div class="nav-item" onclick="showPage('accounts')">
                <i class="fas fa-user-circle"></i>
                <span>Accounts</span>
            </div>
            <div class="nav-item" onclick="showPage('features')">
                <i class="fas fa-star"></i>
                <span>Features</span>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="feature-badge">
                <i class="fas fa-rocket"></i> Professional Edition
            </div>
        </div>
    </div>

    <div class="ai-toggle-container">
        <span class="ai-toggle-label">AI Content</span>
        <label class="ai-switch">
            <input type="checkbox" id="ai-toggle" checked>
            <span class="ai-slider"></span>
        </label>
        <span id="ai-toggle-status">On</span>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Home Page -->
        <div id="home-page" class="page-view active">
            <div class="home-hero">
                <img src="/static/logo/pandabay.png" alt="PandaBay Logo" class="home-logo">
                <p class="subtitle">Automate your Facebook Marketplace listings in 3 easy steps</p>
                <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                    <span class="quick-stat">
                        <i class="fas fa-robot"></i>
                        <span id="total-accounts">{{ accounts|length }}</span> Accounts
                    </span>
                    <span class="quick-stat">
                        <i class="fas fa-list"></i>
                        <span>Active Listings</span>
                    </span>
                </div>
            </div>

            <div class="workflow-steps">
                <!-- Step 1: Add Account -->
                <div class="workflow-step" id="step-1">
                    <div class="workflow-step-header">
                        <div class="workflow-step-number">1</div>
                        <div class="workflow-step-title">
                            <h3>Add Your Facebook Account</h3>
                            <p>Connect your account using cookies for secure automation</p>
                        </div>
                    </div>
                    <div class="workflow-step-content">
                        <p class="workflow-step-description">
                            Export your Facebook cookies using a browser extension and paste them here to securely connect your account.
                        </p>
                        <div class="workflow-step-actions">
                            <button class="btn btn-primary btn-large" onclick="showPage('accounts')">
                                <i class="fas fa-user-plus"></i> Add Account
                            </button>
                            {% if accounts %}
                            <button class="btn btn-success" onclick="document.getElementById('step-1').classList.add('completed')">
                                <i class="fas fa-check"></i> I've Added My Account
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Step 2: Create Listing -->
                <div class="workflow-step" id="step-2">
                    <div class="workflow-step-header">
                        <div class="workflow-step-number">2</div>
                        <div class="workflow-step-title">
                            <h3>Create Your First Listing</h3>
                            <p>Add product details, photos, and let AI handle variations</p>
                        </div>
                    </div>
                    <div class="workflow-step-content">
                        <p class="workflow-step-description">
                            Fill in your product details, upload photos, and create listings with AI-powered title variations to avoid detection.
                        </p>
                        <div class="workflow-step-actions">
                            <button class="btn btn-primary btn-large" onclick="showPage('create')">
                                <i class="fas fa-plus-circle"></i> Create Listing
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Manage Listings -->
                <div class="workflow-step" id="step-3">
                    <div class="workflow-step-header">
                        <div class="workflow-step-number">3</div>
                        <div class="workflow-step-title">
                            <h3>Manage & Relist</h3>
                            <p>View, edit, and automatically relist your products</p>
                        </div>
                    </div>
                    <div class="workflow-step-content">
                        <p class="workflow-step-description">
                            Bulk relist your products, randomize locations, and manage all your listings from one dashboard.
                        </p>
                        <div class="workflow-step-actions">
                            <button class="btn btn-primary btn-large" onclick="showPage('manage')">
                                <i class="fas fa-list"></i> Manage Listings
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Tips -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-lightbulb"></i> Quick Tips
                    </div>
                </div>
                <div class="features-grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
                    <div style="padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <i class="fas fa-magic" style="font-size: 24px; color: var(--primary);"></i>
                            <h4 style="margin: 0; font-size: 16px; font-weight: 700;">AI Title Variation</h4>
                        </div>
                        <p style="font-size: 14px; color: var(--text-secondary); margin: 0; line-height: 1.6;">
                            Our AI generates unique title variations for each listing to avoid Facebook's duplicate detection.
                        </p>
                    </div>
                    <div style="padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <i class="fas fa-map-marker-alt" style="font-size: 24px; color: var(--primary);"></i>
                            <h4 style="margin: 0; font-size: 16px; font-weight: 700;">Location Randomization</h4>
                        </div>
                        <p style="font-size: 14px; color: var(--text-secondary); margin: 0; line-height: 1.6;">
                            Randomize locations for your listings to reach more buyers and avoid detection patterns.
                        </p>
                    </div>
                    <div style="padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <i class="fas fa-shield-alt" style="font-size: 24px; color: var(--primary);"></i>
                            <h4 style="margin: 0; font-size: 16px; font-weight: 700;">Safe Automation</h4>
                        </div>
                        <p style="font-size: 14px; color: var(--text-secondary); margin: 0; line-height: 1.6;">
                            Built-in delays and human-like behavior keep your account safe from Facebook's detection systems.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Listing Page -->
        <div id="create-page" class="page-view">
            <div class="page-header">
                <h2><i class="fas fa-magic"></i> Create New Listing</h2>
                <p>Automate your Facebook Marketplace listings with AI-powered variation</p>
            </div>

            <div class="alert" id="create-alert"></div>

            <form id="create-form" enctype="multipart/form-data">
                <input type="hidden" id="ai-enabled" name="ai_enabled" value="true">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-info-circle"></i> Basic Information
                        </div>
                    </div>

                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">Account <span class="required">*</span></label>
                            <select id="account" name="account" class="form-select" required>
                                <option value="">Select account...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Category
                                <span class="tooltip-icon" data-tooltip="Facebook category path will be selected automatically">i</span>
                            </label>
                            <select id="category" name="category" class="form-select">
                                <option value="__custom__">Custom category path...</option>
                            </select>
                            <div class="category-custom" id="custom-category-wrapper">
                                <div class="input-group">
                                    <input type="text" id="custom-category" class="form-input"
                                           placeholder="Arts and crafts, Art supplies, Canvas & art boards">
                                    <button type="button" class="category-add-btn" id="custom-category-add" title="Add category to list">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="category-info" id="custom-category-info">
                                    <i class="fas fa-info-circle"></i>
                                    <span>Enter the category path exactly as shown on Facebook Marketplace, separated by commas.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Title <span class="required">*</span>
                            <small style="color: var(--text-secondary); font-weight: 400; margin-left: 8px;">
                                Max 90 characters
                            </small>
                            <span class="tooltip-icon" data-tooltip="Bot will add variations to make each listing unique">i</span>
                        </label>
                        <input type="text" id="title" name="title" class="form-input" maxlength="90"
                               placeholder="e.g., Premium Artificial Grass 4m x 2m" required>
                        <small style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem; display: block;">
                            <span id="title-counter">0</span>/90 characters
                        </small>
                    </div>

                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">Price <span class="required">*</span></label>
                            <input type="text" id="price" name="price" class="form-input"
                                   placeholder="e.g., Â£150" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Location <span class="required">*</span></label>
                            <div class="input-group">
                                <input type="text" id="location" name="location" class="form-input"
                                       placeholder="e.g., London, England" required>
                                <button type="button" class="btn btn-secondary" onclick="randomizeLocation()">
                                    <i class="fas fa-dice"></i> Random
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Proxy (Optional)</label>
                        <input type="text" id="proxy" name="proxy" class="form-input"
                               placeholder="http://user:pass@host:port or socks5://host:port">
                        <small style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem; display: block;">
                            Use a single proxy for this listing run.
                        </small>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-edit"></i> Description & Photos
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Description <span class="required">*</span>
                            <span class="tooltip-icon" data-tooltip="Each account will format descriptions in a unique writing style">i</span>
                        </label>
                        <textarea id="description" name="description" class="form-textarea"
                                  placeholder="ð Fast Delivery: 2-4 days
â Free Samples Available

ð· Options Available:
- Budget Range (30mm)
- Mid-Range (35mm)
- Premium Range (40mm)" required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Photos (Up to 5) <span class="required">*</span></label>
                        <div class="file-upload">
                            <input type="file" id="photos" name="photos" multiple accept="image/*" required>
                            <label for="photos" class="file-upload-label">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <div>Click to upload photos or drag and drop</div>
                                <small style="color: var(--text-secondary); margin-top: 8px; display: block;">PNG, JPG up to 10MB each</small>
                            </label>
                        </div>
                        <div id="photos-preview" class="photo-preview-grid"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Product Tags (Optional - Max 20)</label>
                        <input type="text" id="product_tags" name="product_tags" class="form-input"
                               placeholder="grass, artificial grass, thick grass, garden, outdoor (comma-separated, max 20 tags)">
                        <small style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem; display: block;">
                            <i class="fas fa-info-circle"></i> Enter tags separated by commas. Maximum 20 tags allowed.
                        </small>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-secondary btn-full">
                        <i class="fas fa-save"></i> Save Listing
                    </button>
                    <button type="button" class="btn btn-primary btn-full" id="create-btn" disabled>
                        <i class="fas fa-rocket"></i> Start Bot & Create
                    </button>
                </div>
            </form>
        </div>

        <!-- Manage Listings Page -->
        <div id="manage-page" class="page-view">
            <div class="page-header">
                <h2><i class="fas fa-tasks"></i> Manage Listings</h2>
                <p>View, edit, and manage your marketplace listings</p>
            </div>

            <div class="alert" id="manage-alert"></div>

            <!-- Step 1: Select Account -->
            <div class="step-container active">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">
                        <h3>Select Account</h3>
                        <p>Choose which account's listings you want to manage</p>
                    </div>
                </div>

                <div class="account-select-wrapper">
                    <select id="manage-account" class="account-select-large">
                        <option value="">Choose an account to get started...</option>
                    </select>
                </div>
            </div>

            <!-- Actions Container - Hidden until account selected -->
            <div id="actions-container" class="actions-container">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-filter"></i> Filter & Select
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Category Filter</label>
                        <select id="category-filter" class="form-select">
                            <option value="all">All Categories</option>
                            <option value="Other Garden decor">Artificial Grass & Decking</option>
                            <option value="Other Rugs & carpets">Carpets</option>
                        </select>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="select20Listings()">
                            <i class="fas fa-check-double"></i> Select 20
                        </button>
                        <button class="btn btn-secondary" onclick="selectAllListings()">
                            <i class="fas fa-check-square"></i> Select All
                        </button>
                        <button class="btn btn-secondary" onclick="deselectAllListings()">
                            <i class="fas fa-square"></i> Deselect All
                        </button>
                    </div>

                    <div id="selected-count" class="select-count" style="display: none;"></div>

                    <div class="btn-group">
                        <button class="btn btn-success btn-full" id="relist-btn" disabled onclick="relistListings()">
                            <i class="fas fa-redo"></i> Relist Selected
                        </button>
                        <button class="btn btn-primary btn-full" id="randomize-btn" disabled onclick="randomizeLocations()">
                            <i class="fas fa-map-marker-alt"></i> Randomize Locations
                        </button>
                        <button class="btn btn-danger btn-full" id="delete-btn" disabled onclick="deleteListings()">
                            <i class="fas fa-trash-alt"></i> Delete Selected
                        </button>
                    </div>
                </div>
            </div>

            <div id="listings-container" class="listings-grid">
                <div class="no-listings">
                    <div class="no-listings-icon"><i class="fas fa-box-open"></i></div>
                    <h3>No listings found</h3>
                    <p>Select an account to view listings</p>
                </div>
            </div>
        </div>

        <!-- Accounts Page -->
        <div id="accounts-page" class="page-view">
            <div class="page-header">
                <h2><i class="fas fa-users"></i> Facebook Accounts</h2>
                <p>Manage your Facebook account credentials</p>
            </div>

            <div class="alert" id="accounts-alert"></div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-user-plus"></i> Add New Account
                    </div>
                </div>

                <form id="add-account-form">
                    <div class="form-group">
                        <label class="form-label">Account Name <span class="required">*</span></label>
                        <input type="text" id="account-name" class="form-input"
                               placeholder="e.g., john_smith" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cookies JSON <span class="required">*</span></label>
                        <textarea id="cookies-json" class="form-textarea"
                                  placeholder='Paste your Facebook cookies JSON here...' required></textarea>
                        <small style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem; display: block;">
                            <i class="fas fa-info-circle"></i> Export cookies from your Facebook session using a browser extension
                        </small>
                    </div>

                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-plus"></i> Add Account
                    </button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-list-ul"></i> Active Accounts
                    </div>
                </div>

                <div class="grid grid-3">
                    {% for account in accounts %}
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="feature-title">{{ account }}</div>
                        <div class="feature-description">
                            <span class="badge badge-success">
                                <i class="fas fa-check-circle"></i> Active
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Features Page -->
        <div id="features-page" class="page-view">
            <div class="page-header">
                <h2><i class="fas fa-gem"></i> PandaBay Features</h2>
                <p>Powerful automation tools for Facebook Marketplace</p>
                <div id="plan-label" style="margin-top: 8px; font-weight: 600; color: var(--text-secondary);">
                    Current Plan: Free
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-robot stat-icon"></i>
                    <div class="stat-value">100%</div>
                    <div class="stat-label">Automated</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--beige) 0%, var(--accent) 100%);">
                    <i class="fas fa-bolt stat-icon"></i>
                    <div class="stat-value">3x</div>
                    <div class="stat-label">Faster Listing</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--gray-blue) 0%, var(--beige) 100%);">
                    <i class="fas fa-shield-alt stat-icon"></i>
                    <div class="stat-value">Safe</div>
                    <div class="stat-label">Anti-Detection</div>
                </div>
            </div>

            <div class="features-section">
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-magic"></i>
                        </div>
                        <div class="feature-title">AI Title Variation</div>
                        <div class="feature-description">
                            Automatically generates unique title variations for each listing to avoid duplicate detection by Facebook.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-pen-fancy"></i>
                        </div>
                        <div class="feature-title">Unique Writing Styles</div>
                        <div class="feature-description">
                            Each account uses a different writing style (professional, casual, enthusiastic) to make listings appear authentic.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-images"></i>
                        </div>
                        <div class="feature-title">Smart Image Processing</div>
                        <div class="feature-description">
                            Modifies image metadata (EXIF data) to make each upload unique and undetectable as duplicates.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-map-marked-alt"></i>
                        </div>
                        <div class="feature-title">Location Randomization</div>
                        <div class="feature-description">
                            Automatically randomizes listing locations across UK cities to expand your market reach.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-redo-alt"></i>
                        </div>
                        <div class="feature-title">Auto Relist</div>
                        <div class="feature-description">
                            Automatically finds and deletes old listings, then re-uploads them to boost visibility on Marketplace.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="feature-title">Multi-Account Support</div>
                        <div class="feature-description">
                            Manage unlimited Facebook accounts from one dashboard. Perfect for scaling your business.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="feature-title">Product Tags</div>
                        <div class="feature-description">
                            Add up to 20 product tags to improve listing discoverability in Facebook Marketplace search.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <div class="feature-title">Speed Control</div>
                        <div class="feature-description">
                            Adjustable automation speed to balance between quick listing and natural human-like behavior.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="feature-title">Listing Database</div>
                        <div class="feature-description">
                            All listings are stored locally in SQLite database for easy management and tracking.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-eye-slash"></i>
                        </div>
                        <div class="feature-title">Undetected Browser</div>
                        <div class="feature-description">
                            Uses advanced anti-detection techniques to bypass Facebook's bot detection systems.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="feature-title">Batch Processing</div>
                        <div class="feature-description">
                            Process multiple listings in sequence with a single bot session for maximum efficiency.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-trash-restore"></i>
                        </div>
                        <div class="feature-title">Delete Only Mode</div>
                        <div class="feature-description">
                            Bulk delete listings without re-uploading them. Perfect for cleaning up your marketplace inventory.
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 40px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; border: none;">
                <div style="text-align: center;">
                    <h2 style="color: white; margin-bottom: 16px;">
                        <i class="fas fa-crown"></i> Professional Edition
                    </h2>
                    <p style="font-size: 18px; opacity: 0.9; margin-bottom: 24px;">
                        Automate your Facebook Marketplace business and save hours every day
                    </p>
                    <div class="btn-group" style="justify-content: center;">
                        <button class="btn" style="background: white; color: var(--primary);" onclick="showPage('create')">
                            <i class="fas fa-rocket"></i> Get Started Now
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Templates Page -->
        <div id="templates-page" class="page-view">
            <div class="page-header">
                <h2><i class="fas fa-bookmark"></i> Listing Templates</h2>
                <p>Save and reuse listing configurations for faster posting</p>
            </div>

            <div class="alert" id="template-alert"></div>

            <!-- Create New Template Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-plus-circle"></i> Create New Template
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Template Name <span class="required">*</span></label>
                    <input type="text" id="template-name" class="form-input" placeholder="e.g., Artificial Grass Standard">
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" id="template-description" class="form-input" placeholder="Brief description of this template">
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <input type="text" id="template-category" class="form-input" placeholder="Other, Garden decor">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Price Template</label>
                        <input type="text" id="template-price" class="form-input" placeholder="Â£XX.XX">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Description Template</label>
                    <textarea id="template-description-text" class="form-textarea" rows="4" placeholder="Standard description text..."></textarea>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" id="template-location" class="form-input" placeholder="London, England">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Tags</label>
                        <input type="text" id="template-tags" class="form-input" placeholder="grass, artificial, garden">
                    </div>
                </div>

                <button class="btn btn-primary btn-full" onclick="saveTemplate()">
                    <i class="fas fa-save"></i> Save Template
                </button>
            </div>

            <!-- Saved Templates List -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-folder-open"></i> Saved Templates
                    </div>
                </div>

                <div id="templates-list" class="listings-grid">
                    <div class="no-listings">
                        <div class="no-listings-icon"><i class="fas fa-bookmark"></i></div>
                        <h3>No templates saved</h3>
                        <p>Create your first template above</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Page -->
        <div id="analytics-page" class="page-view">
            <div class="page-header">
                <h2><i class="fas fa-chart-line"></i> Analytics Dashboard</h2>
                <p>Track your marketplace performance and insights</p>
            </div>

            <div class="form-group">
                <label class="form-label">Account Filter</label>
                <select id="analytics-account" class="form-select" onchange="loadAnalytics()">
                    <option value="">All Accounts</option>
                    {% for account in accounts %}
                    <option value="{{ account }}">{{ account }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Summary Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-check-circle stat-icon"></i>
                    <div class="stat-value" id="stat-successful">0</div>
                    <div class="stat-label">Successful Posts</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #fdecea 0%, #fce9e6 100%);">
                    <i class="fas fa-times-circle stat-icon"></i>
                    <div class="stat-value" id="stat-failed">0</div>
                    <div class="stat-label">Failed Posts</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--beige) 0%, var(--accent) 100%);">
                    <i class="fas fa-trash-alt stat-icon"></i>
                    <div class="stat-value" id="stat-deletions">0</div>
                    <div class="stat-label">Total Deletions</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--gray-blue) 0%, var(--beige) 100%);">
                    <i class="fas fa-percentage stat-icon"></i>
                    <div class="stat-value" id="stat-success-rate">0%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
            </div>

            <!-- Activity Chart -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-area"></i> Daily Activity (Last 30 Days)
                    </div>
                </div>
                <div style="padding: 20px;">
                    <canvas id="activity-chart" style="max-height: 300px;"></canvas>
                </div>
            </div>

            <!-- Account Performance -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-users"></i> Account Performance
                    </div>
                </div>
                <div id="account-performance-list" style="padding: 20px;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Activity Log Page -->
        <div id="activity-page" class="page-view">
            <div class="page-header">
                <h2><i class="fas fa-history"></i> Activity Log</h2>
                <p>Complete history of all bot actions and operations</p>
            </div>

            <div class="form-group">
                <label class="form-label">Filter by Account</label>
                <select id="activity-account" class="form-select" onchange="loadActivityLog()">
                    <option value="">All Accounts</option>
                </select>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-list"></i> Recent Activity
                    </div>
                </div>
                <div id="activity-log-list" style="padding: 20px;">
                    <div class="no-listings">
                        <div class="no-listings-icon"><i class="fas fa-history"></i></div>
                        <h3>No activity recorded</h3>
                        <p>Activity will appear here as you use the bot</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentAccount = '';
        let listings = [];
        let selectedListings = new Set();
        let currentFilter = 'all';
        let currentUser = null;
        let accountMap = new Map();
        let templatesCache = [];

        const API_URL = window.location.origin + '/api';

        function getToken() {
            return localStorage.getItem('access_token');
        }

        function authFetch(url, options = {}) {
            const token = getToken();
            return fetch(url, {
                ...options,
                headers: {
                    ...options.headers,
                    'Authorization': `Bearer ${token}`
                }
            });
        }

        async function checkAuth() {
            const token = getToken();
            if (!token) {
                window.location.href = '/login';
                return;
            }

            try {
                const response = await authFetch(`${API_URL}/auth/me`);
                if (!response.ok) {
                    throw new Error('Not authenticated');
                }
                const data = await response.json();
                currentUser = data.user;
                updatePlanBadge(currentUser);
            } catch (error) {
                localStorage.removeItem('access_token');
                localStorage.removeItem('refresh_token');
                window.location.href = '/login';
            }
        }

        function updatePlanBadge(user) {
            const planLabel = document.getElementById('plan-label');
            if (planLabel) {
                const tier = (user.is_admin ? 'premium' : (user.subscription_tier || 'free')).toLowerCase();
                planLabel.textContent = `Current Plan: ${tier.charAt(0).toUpperCase() + tier.slice(1)}`;
            }
        }

        function populateAccountSelects(accounts) {
            const createSelect = document.getElementById('account');
            const manageSelect = document.getElementById('manage-account');
            const activitySelect = document.getElementById('activity-account');

            const options = accounts.map(acc => `<option value="${acc.id}">ð¤ ${acc.account_name}</option>`).join('');

            if (createSelect) {
                createSelect.innerHTML = '<option value="">Select account...</option>' + options;
            }
            if (manageSelect) {
                manageSelect.innerHTML = '<option value="">Choose an account to get started...</option>' + options;
            }
            if (activitySelect) {
                activitySelect.innerHTML = '<option value="">All Accounts</option>' + options;
            }
        }

        async function loadAccounts() {
            try {
                const response = await authFetch(`${API_URL}/accounts`);
                if (!response.ok) {
                    throw new Error('Failed to load accounts');
                }
                const data = await response.json();
                const accounts = data.accounts || [];
                accountMap = new Map(accounts.map(acc => [String(acc.id), acc.account_name]));
                populateAccountSelects(accounts);

                if (accounts.length === 0) {
                    showAlert('accounts-alert', 'info', 'No accounts yet. Add one to start listing.');
                }
            } catch (error) {
                console.error('Error loading accounts:', error);
            }
        }

        // UK Locations
        const ukLocations = [
            'London, England', 'Birmingham, England', 'Manchester, England', 'Leeds, England',
            'Liverpool, England', 'Newcastle, England', 'Sheffield, England', 'Bristol, England',
            'Glasgow, Scotland', 'Edinburgh, Scotland', 'Cardiff, Wales', 'Belfast, Northern Ireland'
        ];

        // Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page-view').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById(pageId + '-page').classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
        }

        // Randomize location
        function randomizeLocation() {
            const randomLoc = ukLocations[Math.floor(Math.random() * ukLocations.length)];
            document.getElementById('location').value = randomLoc;
        }

        // Title character counter
        document.getElementById('title').addEventListener('input', function() {
            const counter = document.getElementById('title-counter');
            const count = this.value.length;
            counter.textContent = count;

            // Change color based on character count
            if (count > 80) {
                counter.style.color = '#d97668'; // Danger color when close to limit
            } else if (count > 60) {
                counter.style.color = '#C8B896'; // Accent color
            } else {
                counter.style.color = '#7a8a96'; // Gray
            }
        });

        // File upload handler
        document.getElementById('photos').addEventListener('change', function() {
            const label = document.querySelector('.file-upload-label');
            const count = this.files.length;

            if (count > 0) {
                const icon = count > 5 ? 'fa-exclamation-triangle' : 'fa-check-circle';
                const message = count > 5
                    ? `Too many files (${count}/5 max)`
                    : `${count} photo(s) selected`;

                label.innerHTML = `<i class="fas ${icon}"></i><div>${message}</div>`;
                label.style.background = count > 5 ? '#fdecea' : '#e8f5e9';
                label.style.borderColor = count > 5 ? '#d97668' : '#88b398';
                label.style.color = count > 5 ? '#d97668' : '#88b398';
            } else {
                label.innerHTML = '<i class="fas fa-cloud-upload-alt"></i><div>Click to upload photos or drag and drop</div>';
                label.style.background = '';
                label.style.borderColor = '';
                label.style.color = '';
            }
        });

        // Account selection in manage page
        document.getElementById('manage-account').addEventListener('change', function() {
            currentAccount = this.value;
            const actionsContainer = document.getElementById('actions-container');

            if (currentAccount) {
                // Show actions container with animation
                actionsContainer.classList.add('visible');
                loadListings(currentAccount);
            } else {
                // Hide actions container
                actionsContainer.classList.remove('visible');
                clearListings();
            }
        });

        // Account selection in create page
        document.getElementById('account').addEventListener('change', function() {
            currentAccount = this.value;
        });

        // Category filter
        document.getElementById('category-filter').addEventListener('change', function() {
            currentFilter = this.value;
            filterListings();
        });

        // Load listings
        async function loadListings(account) {
            try {
                console.log('Loading listings for account:', account);
                const response = await authFetch(`${API_URL}/listings?account_id=${encodeURIComponent(account)}`);
                const data = await response.json();
                console.log('Received data:', data);
                listings = data.listings || [];
                console.log('Total listings:', listings.length);
                filterListings();
            } catch (error) {
                console.error('Error loading listings:', error);
                listings = [];
                displayListings();
            }
        }

        // Filter listings
        function filterListings() {
            let filtered = listings;
            if (currentFilter !== 'all') {
                filtered = listings.filter(l => l.category === currentFilter);
            }
            displayListings(filtered);
        }

        // Clear listings
        function clearListings() {
            selectedListings.clear();
            listings = [];
            displayListings();
        }

        // Display listings
        function displayListings(listingsToShow = listings) {
            const container = document.getElementById('listings-container');

            if (!listingsToShow || listingsToShow.length === 0) {
                container.innerHTML = `
                    <div class="no-listings">
                        <div class="no-listings-icon"><i class="fas fa-box-open"></i></div>
                        <h3>No listings found</h3>
                        <p>Select an account to view listings</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = listingsToShow.map(listing => {
                const firstImage = (listing.images && listing.images.length > 0) ? listing.images[0].image_url : '';
                const imageUrl = firstImage || '';

                return `
                    <div class="listing-card ${selectedListings.has(listing.id) ? 'selected' : ''}"
                         onclick="toggleListing(${listing.id})">
                        ${imageUrl ? `<img src="${imageUrl}" class="listing-image" alt="${listing.title}" onerror="this.style.display='none'">` : ''}
                        <div class="listing-content">
                            <div class="listing-header">
                                <input type="checkbox" class="listing-checkbox"
                                       ${selectedListings.has(listing.id) ? 'checked' : ''}
                                       onclick="event.stopPropagation()">
                            </div>
                            <div class="listing-title">${listing.title}</div>
                            <div class="listing-price">${listing.price}</div>
                            <div class="listing-meta">
                                <span><span class="badge badge-primary"><i class="fas fa-tag"></i> ${listing.category || 'Uncategorized'}</span></span>
                                <span><i class="fas fa-calendar-alt"></i> ${new Date(listing.created_at).toLocaleDateString()}</span>
                            </div>
                            <div class="listing-actions">
                                <button class="btn-icon" onclick="editListing(${listing.id}); event.stopPropagation();">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-icon" onclick="deleteListing(${listing.id}); event.stopPropagation();">
                                    <i class="fas fa-trash-alt"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            updateSelectedCount();
        }

        // Toggle listing selection
        function toggleListing(id) {
            if (selectedListings.has(id)) {
                selectedListings.delete(id);
            } else {
                selectedListings.add(id);
            }
            displayListings();
        }

        // Update selected count
        function updateSelectedCount() {
            const countDiv = document.getElementById('selected-count');
            const count = selectedListings.size;

            if (count > 0) {
                countDiv.style.display = 'block';
                countDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${count} listing${count !== 1 ? 's' : ''} selected`;
                document.getElementById('relist-btn').disabled = false;
                document.getElementById('randomize-btn').disabled = false;
                document.getElementById('delete-btn').disabled = false;
            } else {
                countDiv.style.display = 'none';
                document.getElementById('relist-btn').disabled = true;
                document.getElementById('randomize-btn').disabled = true;
                document.getElementById('delete-btn').disabled = true;
            }
        }

        // Select 20 listings
        function select20Listings() {
            selectedListings.clear();
            const count = Math.min(20, listings.length);
            for (let i = 0; i < count; i++) {
                selectedListings.add(listings[i].id);
            }
            displayListings();
        }

        // Select all listings
        function selectAllListings() {
            selectedListings.clear();
            listings.forEach(listing => selectedListings.add(listing.id));
            displayListings();
        }

        // Deselect all listings
        function deselectAllListings() {
            selectedListings.clear();
            displayListings();
        }

        // Edit listing
        function editListing(id) {
            const listing = listings.find(l => l.id === id);
            if (!listing) return;

            document.getElementById('account').value = currentAccount;
            document.getElementById('title').value = listing.title;
            document.getElementById('price').value = listing.price;
            document.getElementById('description').value = listing.description;
            setCategorySelection(listing.category);
            document.getElementById('location').value = listing.location;

            showPage('create');
        }

        // Delete listing
        async function deleteListing(id) {
            if (!confirm('Delete this listing from the database?')) return;

            try {
                const response = await authFetch(`${API_URL}/listings/${id}`, { method: 'DELETE' });
                const result = await response.json();
                if (!response.ok) {
                    throw new Error(result.error || 'Delete failed');
                }
                showAlert('manage-alert', 'success', result.message || 'Listing deleted');
                loadListings(currentAccount);
            } catch (error) {
                showAlert('manage-alert', 'error', 'Error deleting listing');
            }
        }

        // Relist listings
        async function relistListings() {
            if (selectedListings.size === 0) return;

            const btn = document.getElementById('relist-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Relisting...';

            try {
                const response = await authFetch(`${API_URL}/listings/relist`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ listing_ids: Array.from(selectedListings) })
                });

                const result = await response.json();
                if (!response.ok) {
                    throw new Error(result.error || 'Relist failed');
                }
                showAlert('manage-alert', 'success', result.message || 'Relist queued');
                selectedListings.clear();
                loadListings(currentAccount);
            } catch (error) {
                showAlert('manage-alert', 'error', 'Error relisting');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-redo"></i> Relist Selected';
            }
        }

        // Delete listings only (no re-upload)
        async function deleteListings() {
            if (selectedListings.size === 0) return;

            const count = selectedListings.size;
            if (!confirm(`Are you sure you want to delete ${count} listing${count !== 1 ? 's' : ''}? This action cannot be undone.`)) {
                return;
            }

            const btn = document.getElementById('delete-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Deleting...';

            try {
                const response = await authFetch(`${API_URL}/listings/batch-delete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ listing_ids: Array.from(selectedListings) })
                });

                const result = await response.json();
                if (!response.ok) {
                    throw new Error(result.error || 'Delete failed');
                }
                showAlert('manage-alert', 'success', result.message || 'Listings deleted');
                selectedListings.clear();
                loadListings(currentAccount);
            } catch (error) {
                showAlert('manage-alert', 'error', 'Error deleting listings');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-trash-alt"></i> Delete Selected';
            }
        }

        // Randomize locations
        async function randomizeLocations() {
            if (selectedListings.size === 0) return;

            const btn = document.getElementById('randomize-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Randomizing...';

            try {
                const response = await authFetch(`${API_URL}/listings/randomize-locations`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ listing_ids: Array.from(selectedListings) })
                });

                const result = await response.json();
                if (!response.ok) {
                    throw new Error(result.error || 'Randomize failed');
                }
                showAlert('manage-alert', 'success', result.message || 'Locations randomized');
                loadListings(currentAccount);
            } catch (error) {
                showAlert('manage-alert', 'error', 'Error randomizing locations');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-map-marker-alt"></i> Randomize Locations';
            }
        }

        // Category custom path handling
        const categorySelect = document.getElementById('category');
        const customCategoryWrapper = document.getElementById('custom-category-wrapper');
        const customCategoryInput = document.getElementById('custom-category');
        const customCategoryAddBtn = document.getElementById('custom-category-add');
        const customCategoryStorageKey = 'customCategories';

        function addCustomCategoryOption(value, persist) {
            const trimmed = (value || '').trim();
            if (!trimmed) return;

            const existing = Array.from(categorySelect.options).find(opt => opt.value === trimmed);
            if (existing) return;

            const customOption = document.querySelector('#category option[value="__custom__"]');
            const option = document.createElement('option');
            option.value = trimmed;
            option.textContent = trimmed;
            categorySelect.insertBefore(option, customOption);

            if (persist) {
                const stored = JSON.parse(localStorage.getItem(customCategoryStorageKey) || '[]');
                if (!stored.includes(trimmed)) {
                    stored.push(trimmed);
                    localStorage.setItem(customCategoryStorageKey, JSON.stringify(stored));
                }
            }

            if (categorySelect.style.display === 'none') {
                categorySelect.style.display = '';
            }
        }

        function loadCustomCategories() {
            try {
                const stored = JSON.parse(localStorage.getItem(customCategoryStorageKey) || '[]');
                if (Array.isArray(stored)) {
                    stored.forEach(value => addCustomCategoryOption(value, false));
                }
                if (!stored || stored.length === 0) {
                    categorySelect.style.display = 'none';
                    customCategoryWrapper.classList.add('active');
                    categorySelect.value = '__custom__';
                }
            } catch (error) {
                console.warn('Could not load custom categories', error);
            }
        }

        function toggleCustomCategory() {
            const isCustom = categorySelect.value === '__custom__';
            customCategoryWrapper.classList.toggle('active', isCustom);
            customCategoryInput.required = isCustom;
            if (!isCustom) {
                customCategoryInput.value = '';
            }
        }

        function setCategorySelection(value) {
            const options = Array.from(categorySelect.options).map(opt => opt.value);
            if (options.includes(value)) {
                categorySelect.value = value;
                toggleCustomCategory();
                return;
            }

            categorySelect.value = '__custom__';
            customCategoryInput.value = value || '';
            toggleCustomCategory();
        }

        function applyCustomCategory(formData) {
            if (categorySelect.value !== '__custom__') {
                return true;
            }

            const customValue = customCategoryInput.value.trim();
            if (!customValue) {
                showAlert('create-alert', 'error', 'Please enter a custom category path (comma-separated).');
                return false;
            }

            formData.set('category', customValue);
            return true;
        }

        customCategoryAddBtn.addEventListener('click', function() {
            const customValue = customCategoryInput.value.trim();
            if (!customValue) {
                showAlert('create-alert', 'error', 'Please enter a custom category path (comma-separated).');
                return;
            }

            addCustomCategoryOption(customValue, true);
            categorySelect.value = customValue;
            toggleCustomCategory();
            showAlert('create-alert', 'success', 'Custom category added to the list.');
        });

        categorySelect.addEventListener('change', toggleCustomCategory);
        loadCustomCategories();
        toggleCustomCategory();

        // Photos preview
        const photosInput = document.getElementById('photos');
        const photosPreview = document.getElementById('photos-preview');

        photosInput.addEventListener('change', function() {
            photosPreview.innerHTML = '';
            const files = Array.from(photosInput.files || []);

            files.forEach(file => {
                if (!file.type.startsWith('image/')) {
                    return;
                }

                const url = URL.createObjectURL(file);
                const item = document.createElement('div');
                item.className = 'photo-preview-item';

                const img = document.createElement('img');
                img.src = url;
                img.onload = () => URL.revokeObjectURL(url);

                item.appendChild(img);
                photosPreview.appendChild(item);
            });
        });

        // AI toggle handling
        const aiToggle = document.getElementById('ai-toggle');
        const aiToggleStatus = document.getElementById('ai-toggle-status');
        const aiEnabledInput = document.getElementById('ai-enabled');
        const aiToggleStorageKey = 'aiEnabled';

        function setAiToggleState(isEnabled) {
            aiToggle.checked = isEnabled;
            aiToggleStatus.textContent = isEnabled ? 'On' : 'Off';
            aiEnabledInput.value = isEnabled ? 'true' : 'false';
        }

        function loadAiToggle() {
            const stored = localStorage.getItem(aiToggleStorageKey);
            const isEnabled = stored === null ? true : stored === 'true';
            setAiToggleState(isEnabled);
        }

        aiToggle.addEventListener('change', function() {
            const isEnabled = aiToggle.checked;
            localStorage.setItem(aiToggleStorageKey, isEnabled ? 'true' : 'false');
            setAiToggleState(isEnabled);
        });

        loadAiToggle();

        // Create form submission (Save Listing)
        document.getElementById('create-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const accountId = document.getElementById('account').value;
            const title = document.getElementById('title').value.trim();
            const price = document.getElementById('price').value.trim();
            const description = document.getElementById('description').value.trim();
            const categoryValue = categorySelect.value === '__custom__'
                ? customCategoryInput.value.trim()
                : categorySelect.value;
            const location = document.getElementById('location').value.trim();
            const tags = document.getElementById('product_tags').value.trim();
            const proxy = document.getElementById('proxy').value.trim();
            const aiEnabled = document.getElementById('ai-enabled').value === 'true';

            if (!accountId) {
                showAlert('create-alert', 'error', 'Please select an account.');
                return;
            }
            if (!categoryValue) {
                showAlert('create-alert', 'error', 'Please enter a category path.');
                return;
            }

            try {
                const response = await authFetch(`${API_URL}/listings/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fb_account_id: parseInt(accountId),
                        title,
                        price,
                        description,
                        category: categoryValue,
                        location,
                        product_tags: tags,
                        proxy,
                        ai_enabled: aiEnabled,
                        status: 'draft'
                    })
                });

                const result = await response.json();
                if (!response.ok) {
                    throw new Error(result.error || 'Error saving listing');
                }
                showAlert('create-alert', 'success', result.message || 'Listing saved');
            } catch (error) {
                showAlert('create-alert', 'error', error.message || 'Error saving listing');
            }
        });

        // Add account form submission
        document.getElementById('add-account-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const accountName = document.getElementById('account-name').value.trim();
            const cookiesJson = document.getElementById('cookies-json').value.trim();

            let cookies;
            try {
                cookies = JSON.parse(cookiesJson);
            } catch (error) {
                showAlert('accounts-alert', 'error', 'Cookies must be valid JSON');
                return;
            }

            try {
                const response = await authFetch(`${API_URL}/accounts/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        account_name: accountName,
                        cookies
                    })
                });

                const result = await response.json();
                if (!response.ok) {
                    throw new Error(result.error || 'Failed to add account');
                }
                showAlert('accounts-alert', 'success', result.message || 'Account added');
                this.reset();
                loadAccounts();
            } catch (error) {
                showAlert('accounts-alert', 'error', error.message || 'Error adding account');
            }
        });

        // Create button click (Start Bot & Create)
        document.getElementById('create-btn').addEventListener('click', async function() {
            const accountId = document.getElementById('account').value;
            const title = document.getElementById('title').value.trim();
            const price = document.getElementById('price').value.trim();
            const description = document.getElementById('description').value.trim();
            const categoryValue = categorySelect.value === '__custom__'
                ? customCategoryInput.value.trim()
                : categorySelect.value;
            const location = document.getElementById('location').value.trim();
            const tags = document.getElementById('product_tags').value.trim();
            const proxy = document.getElementById('proxy').value.trim();
            const aiEnabled = document.getElementById('ai-enabled').value === 'true';

            if (!accountId) {
                showAlert('create-alert', 'error', 'Please select an account.');
                return;
            }
            if (!categoryValue) {
                showAlert('create-alert', 'error', 'Please enter a category path.');
                return;
            }

            try {
                const response = await authFetch(`${API_URL}/listings/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fb_account_id: parseInt(accountId),
                        title,
                        price,
                        description,
                        category: categoryValue,
                        location,
                        product_tags: tags,
                        proxy,
                        ai_enabled: aiEnabled,
                        status: 'pending'
                    })
                });

                const result = await response.json();
                if (!response.ok) {
                    throw new Error(result.error || 'Error creating listing');
                }
                showAlert('create-alert', 'success', result.message || 'Listing created');
            } catch (error) {
                showAlert('create-alert', 'error', error.message || 'Error creating listing');
            }
        });

        // Show alert function
        function showAlert(id, type, message) {
            const alert = document.getElementById(id);
            alert.className = `alert ${type}`;
            const icon = type === 'success' ? 'fa-check-circle' : (type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle');
            alert.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
            alert.style.display = 'block';

            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // ============================================================================
        // TEMPLATES FUNCTIONALITY
        // ============================================================================

        async function loadTemplates() {
            try {
                const response = await authFetch(`${API_URL}/templates`);
                const data = await response.json();

                templatesCache = data.templates || [];
                if (templatesCache.length > 0) {
                    displayTemplates(templatesCache);
                }
            } catch (error) {
                console.error('Error loading templates:', error);
            }
        }

        function displayTemplates(templates) {
            const container = document.getElementById('templates-list');

            container.innerHTML = templates.map(template => `
                <div class="listing-card" style="cursor: default;">
                    <div class="listing-content">
                        <div class="listing-header" style="margin-bottom: 12px;">
                            <div class="listing-title" style="margin: 0;">${template.name}</div>
                        </div>
                        ${template.description ? `<p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">${template.description}</p>` : ''}
                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
                            <div><strong>Category:</strong> ${template.category || 'N/A'}</div>
                            <div><strong>Price:</strong> ${template.price_template || 'N/A'}</div>
                            <div><strong>Used:</strong> ${template.use_count} times</div>
                        </div>
                        <div class="btn-group" style="margin-top: 12px;">
                            <button class="btn btn-primary" onclick="applyTemplateToForm(${template.id})" style="flex: 1;">
                                <i class="fas fa-check"></i> Apply
                            </button>
                            <button class="btn btn-danger" onclick="deleteTemplate(${template.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function saveTemplate() {
            const templateData = {
                name: document.getElementById('template-name').value.trim(),
                description: document.getElementById('template-description').value.trim(),
                category: document.getElementById('template-category').value.trim(),
                price_template: document.getElementById('template-price').value.trim(),
                description_template: document.getElementById('template-description-text').value.trim(),
                location: document.getElementById('template-location').value.trim(),
                product_tags: document.getElementById('template-tags').value.trim()
            };

            if (!templateData.name) {
                showAlert('template-alert', 'error', 'Please enter a template name');
                return;
            }

            try {
                const response = await authFetch(`${API_URL}/templates`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(templateData)
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert('template-alert', 'success', result.message || 'Template saved successfully!');
                    document.getElementById('template-name').value = '';
                    document.getElementById('template-description').value = '';
                    document.getElementById('template-category').value = '';
                    document.getElementById('template-price').value = '';
                    document.getElementById('template-description-text').value = '';
                    document.getElementById('template-location').value = '';
                    document.getElementById('template-tags').value = '';
                    loadTemplates();
                } else {
                    showAlert('template-alert', 'error', result.error || 'Template save failed');
                }
            } catch (error) {
                showAlert('template-alert', 'error', 'Error saving template');
            }
        }

        async function applyTemplateToForm(templateId) {
            const template = templatesCache.find(t => t.id === templateId);
            if (!template) {
                showAlert('template-alert', 'error', 'Template not found');
                return;
            }
            showPage('create');

            if (template.category) setCategorySelection(template.category);
            if (template.price_template) document.getElementById('price').value = template.price_template;
            if (template.description_template) document.getElementById('description').value = template.description_template;
            if (template.location) document.getElementById('location').value = template.location;
            if (template.product_tags) document.getElementById('product_tags').value = template.product_tags;

            showAlert('create-alert', 'success', `Template "${template.name}" applied!`);
        }

        async function deleteTemplate(templateId) {
            if (!confirm('Delete this template?')) return;

            try {
                const response = await authFetch(`${API_URL}/templates/${templateId}`, {method: 'DELETE'});
                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'Delete failed');
                }
                showAlert('template-alert', 'success', result.message || 'Template deleted');
                loadTemplates();
            } catch (error) {
                showAlert('template-alert', 'error', 'Error deleting template');
            }
        }

        // ============================================================================
        // ANALYTICS FUNCTIONALITY
        // ============================================================================

        async function loadAnalytics() {
            try {
                const response = await authFetch(`${API_URL}/analytics/dashboard`);
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to load analytics');
                }

                const recent = data.recent_listings || [];
                document.getElementById('stat-successful').textContent = recent.length;
                document.getElementById('stat-failed').textContent = 0;
                document.getElementById('stat-deletions').textContent = 0;
                document.getElementById('stat-success-rate').textContent = recent.length ? '100%' : '0%';
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        function displayAnalyticsSummary(analytics) {
            const stats = analytics.action_stats;
            let totalSuccessful = 0, totalFailed = 0, totalDeletions = 0;

            Object.keys(stats).forEach(action => {
                if (action.includes('create') || action.includes('listing')) {
                    totalSuccessful += stats[action].successful || 0;
                    totalFailed += stats[action].failed || 0;
                }
                if (action.includes('delete')) {
                    totalDeletions += stats[action].total || 0;
                }
            });

            const successRate = totalSuccessful + totalFailed > 0 ? Math.round((totalSuccessful / (totalSuccessful + totalFailed)) * 100) : 0;

            document.getElementById('stat-successful').textContent = totalSuccessful;
            document.getElementById('stat-failed').textContent = totalFailed;
            document.getElementById('stat-deletions').textContent = totalDeletions;
            document.getElementById('stat-success-rate').textContent = successRate + '%';

            displayActivityChart(analytics.daily_activity);
        }

        function displayActivityChart(dailyActivity) {
            const canvas = document.getElementById('activity-chart');
            const ctx = canvas.getContext('2d');

            if (dailyActivity.length === 0) {
                ctx.font = '16px Inter';
                ctx.fillStyle = '#7a8a96';
                ctx.textAlign = 'center';
                ctx.fillText('No activity data', canvas.width / 2, canvas.height / 2);
                return;
            }

            canvas.width = canvas.offsetWidth;
            canvas.height = 300;

            const barWidth = canvas.width / dailyActivity.length;
            const maxCount = Math.max(...dailyActivity.map(d => d.count), 1);

            ctx.fillStyle = '#30364F';
            dailyActivity.forEach((day, index) => {
                const barHeight = (day.count / maxCount) * (canvas.height - 40);
                const x = index * barWidth;
                const y = canvas.height - barHeight - 20;

                ctx.fillRect(x + 2, y, barWidth - 4, barHeight);
                ctx.font = '12px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(day.count, x + barWidth / 2, y - 5);
            });
        }

        function displayAccountPerformance(accounts) {
            const container = document.getElementById('account-performance-list');

            if (accounts.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No account data</p>';
                return;
            }

            container.innerHTML = accounts.map(account => `
                <div style="border: 2px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="margin: 0; font-size: 18px;"><i class="fas fa-user-circle"></i> ${account.account_name}</h3>
                        <span class="badge-primary" style="font-size: 14px; padding: 6px 12px;">${account.success_rate}% Success</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px; font-size: 14px;">
                        <div><div style="color: var(--text-secondary);">Total</div><div style="font-size: 20px; font-weight: 700; color: var(--primary);">${account.total_listings}</div></div>
                        <div><div style="color: var(--text-secondary);">Successful</div><div style="font-size: 20px; font-weight: 700; color: var(--success);">${account.successful_listings}</div></div>
                        <div><div style="color: var(--text-secondary);">Failed</div><div style="font-size: 20px; font-weight: 700; color: var(--danger);">${account.failed_listings}</div></div>
                        <div><div style="color: var(--text-secondary);">Deletions</div><div style="font-size: 20px; font-weight: 700;">${account.total_deletions}</div></div>
                    </div>
                </div>
            `).join('');
        }

        // ============================================================================
        // ACTIVITY LOG FUNCTIONALITY
        // ============================================================================

        async function loadActivityLog() {
            const container = document.getElementById('activity-log-list');
            container.innerHTML = '<div class="no-listings"><div class="no-listings-icon"><i class="fas fa-spinner fa-spin"></i></div><h3>Loading activity...</h3></div>';

            try {
                const accountId = document.getElementById('activity-account')?.value || '';
                const url = accountId ? `${API_URL}/activity?account_id=${accountId}` : `${API_URL}/activity`;
                const response = await authFetch(url);

                if (!response.ok) {
                    throw new Error('Failed to load activity');
                }

                const data = await response.json();

                if (data.activities && data.activities.length > 0) {
                    displayActivityLog(data.activities);
                } else {
                    container.innerHTML = `
                        <div class="no-listings">
                            <div class="no-listings-icon"><i class="fas fa-history"></i></div>
                            <h3>No activity recorded</h3>
                            <p>Activity will appear here as you use the bot</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading activity:', error);
                container.innerHTML = `
                    <div class="no-listings">
                        <div class="no-listings-icon"><i class="fas fa-history"></i></div>
                        <h3>No activity recorded</h3>
                        <p>Activity will appear here as you use the bot</p>
                    </div>
                `;
            }
        }

        function displayActivityLog(activities) {
            const container = document.getElementById('activity-log-list');

            container.innerHTML = activities.map(activity => {
                const statusColor = activity.status === 'success' ? 'var(--success)' : activity.status === 'error' ? 'var(--danger)' : 'var(--text-secondary)';
                const statusIcon = activity.status === 'success' ? 'fa-check-circle' : activity.status === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';

                return `
                    <div style="border-left: 4px solid ${statusColor}; padding: 16px; margin-bottom: 12px; background: var(--card-bg); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <div style="font-weight: 700; font-size: 15px; margin-bottom: 4px;">
                                    <i class="fas ${statusIcon}" style="color: ${statusColor};"></i>
                                    ${activity.action_type.replace(/_/g, ' ').toUpperCase()}
                                </div>
                                ${activity.listing_title ? `<div style="font-size: 14px;">${activity.listing_title}</div>` : ''}
                                ${activity.details ? `<div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">${activity.details}</div>` : ''}
                            </div>
                            <div style="text-align: right; font-size: 12px; color: var(--text-secondary);">
                                <div><strong>${activity.account_name}</strong></div>
                                <div>${new Date(activity.timestamp).toLocaleString()}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initial load
        checkAuth().then(() => {
            loadAccounts();
            loadTemplates();
            loadAnalytics();
        });

        // Override showPage to load data when switching to new pages
        const originalShowPage = showPage;
        showPage = function(pageName) {
            originalShowPage(pageName);

            if (pageName === 'templates') loadTemplates();
            else if (pageName === 'analytics') loadAnalytics();
            else if (pageName === 'activity') loadActivityLog();
        };
    </script>
</body>
</html>
